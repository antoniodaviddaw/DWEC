<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reto 3</title>
    <style>
        body{
            font-size: 0.8em;
            text-align: center;
            font-family: Arial, Helvetica, sans-serif;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(90deg, rgb(84, 229, 255), rgb(46, 137, 255));
        }
        #check{
            padding: 1em;
        }
        fieldset{
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 2em;
            background-color: white;
            margin: auto;
            width: 50%;
            border-radius: 10px;

        }

        legend{
            background-color: white;
            border: 1px solid lightgray;
            padding: 1em;
            border-radius: 10px;
        }
        #checkall{
            margin: auto;
            margin-top: 1em;
            margin-bottom: 2em;
            padding: 1em;
            background:linear-gradient(90deg, rgb(53, 143, 35), rgb(7, 110, 7));
        }
        label{
            font-weight: bold;
        }
        button{
            margin: 1em;
            padding: 0.5em;
            width: 15%;
            color: white;
            background:linear-gradient(90deg, rgb(20, 169, 228), rgb(26, 109, 218));
            border-radius: 5px;
            border: solid 1px gray;
        }
        input{
            height: 1.5em;
            
        }
        button:hover{
            cursor: pointer;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <p id="check"></p>
    <fieldset>
        <legend>Validar transacción</legend>

        <div>
            <label for="datetime">Fecha y hora de creación:</label>
            <input type="text" id="datetime" placeholder="“dd/mm/aaaa hh:mm”">
            <span class="error"></span><br>
            <button id="b1">Validar</button>
            <hr>
        </div>

        <div>
            <label for="cooker">Cocinero:</label>
            <input type="text" id="cooker" placeholder="ej. WW$1234">
            <span class="error"></span><br>
            <button id="b2">Validar</button>
            <p><i>dos letras mayúsculas, símbolo, y cuatro dígitos</i></p>
            <hr>
        </div>

        <div>
            <label for="address">Destinatario:</label>
            <input type="text" id="address" placeholder="ej. NM_alburquerque:1234">
            <span class="error"></span><br>
            <p><i>dos o tres letras mayúsculas, guión bajo, ciudad en minúsculas, dos puntos, y código de distrito de 4 dígitos</i></p>
            <button id="b3">Validar</button>
            <hr>
        </div>

        <div>
            <label for="grs">Gramos:</label>
            <input type="text" id="grs" placeholder="1000-5000">
            <span class="error"></span><br>
            <button id="b4">Validar</button>
            <hr>
        </div>

        <div>
            <label for="comp">Composición:</label>
            <input type="text" id="comp" placeholder="ej. 200gC3OH7">
            <span class="error"></span><br>
            <p><i>Estará formado por una cantidad en gramos seguida de dos conjuntos de una o dos letras seguidas o no de un número. </i></p>
            <button id="b5">Validar</button>
            <hr>
        </div>

        <div>
            <label for="bank">Número de cuenta de EEUU:</label>
            <input type="text" id="bank" placeholder="ej.AA01-123400120000-10">
            <span class="error"></span><br>
            <button id="b6">Validar</button><br>
            <ol>Formato:
                <li><i>Dos letras: suponemos que el valor de cada letra es del 1 al 26 (no hay ñ ni ll).</i></li>

                <li><i>Dos dígitos: debe corresponderse con la suma de la primera letra y la segunda: en caso de que sea menor que 10 se pone el 0 delante.</i></li>

                <li><i>Un guión</i></li>

                <li><i>Doce dígitos de cuenta</i></li>

                <li><i>Un guión</i></li>

                <li><i>Dos dígitos de control: los dos primeros deben ser la suma de los 6 primeros dígitos de la cuenta dividido entre 6 y extrayendo solamente su parte entera; y los dos últimos exactamente igual, pero con los 6 siguientes</i></li>

                <li><i>Si el número está correcto se colocará en un campo de texto al lado del anterior, pero sin guiones: solamente los números y las letras</i></li>

            </ol>
            <hr>
        </div>

    </fieldset>
    <!--Por gusto he decidido añadir un botón que lo compruebe todo-->
    <button id="checkall">Validar todo</button>
</body>
<script>
    //Hasta la parte del numero del banco es todo sencillo, tan solo testear un patrón
    let validarDatetime=()=>{
        let pattern=/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}\s[0-9]{2}:[0-9]{2}$/
        let Fecha=document.getElementById("datetime").value 
        let error=document.querySelector('#datetime + span.error')
        if(!pattern.test(Fecha)|Fecha===''){
            error.textContent="❌"
            return false
        }
        error.textContent="✅"
        return true
        
    }

    let validarcooker=()=>{
        let pattern=/^[A-Z]{2}[^A-za-z\d][0-9]{4}$/
        let cooker=document.getElementById("cooker").value 
        let error=document.querySelector('#cooker + span.error')
        if(!pattern.test(cooker)|cooker===''){
            error.textContent="❌"
            return false;
        }
        error.textContent="✅"
        return true
    }

    let validarAdress=()=>{
        let pattern=/^[A-Z]{2}_[a-z]+:[1-9]{4}$/
        let address=document.getElementById("address").value 
        let error=document.querySelector('#address + span.error')
        if(!pattern.test(address)|address===''){
            error.textContent="❌"
            return false;
        }
        error.textContent="✅"
        return true
    }

    let validarGrs=()=>{
        let pattern=/^[1-4]\d{3}$|5000/
        let grs=document.getElementById("grs").value 
        let error=document.querySelector('#grs + span.error')
        if(!pattern.test(grs)|grs===''){
            error.textContent="❌"
            return false;
        }
        error.textContent="✅"
        return true
    }

    let validarComp=()=>{
        let pattern=/^[1-9]\d+g\w{1,2}\d?\w{1,2}\d?$/
        let comp=document.getElementById("comp").value 
        let error=document.querySelector('#comp + span.error')
        if(!pattern.test(comp)|comp===''){
            error.textContent="❌"
            return false;
        }
        error.textContent="✅"
        return true
    }

    let validarBank=()=>{
        let pattern=/^[^ñÑ1-9]{2}\d{2}-\d{12}-\d{2}$/
        let bank=document.getElementById("bank").value 
        let error=document.querySelector('#bank + span.error')
        if(!pattern.test(bank)|bank===''){
            error.textContent="❌"
            return false;
        }
        //si lo separo antes, da error el pattern
        bank=bank.split("-")
        if(!bank1part(bank[0])){
            error.textContent="❌ por los primeros numeros"
            return false;
        }

        if(!bank2part(bank[1],bank[2])){
            error.textContent="❌ por los digitos de control"
            return false;
        }
        error.textContent=`✅ ${bank[0].toUpperCase()}${bank[1]}${bank[2]}`
        return true
        


        
    }
    let bank1part=(bank)=>{
        let abecedario=[
            'A','B','C','D','E','F',
            'G','H','I','J','K','L',
            'M','N','O','P','Q','R',
            'S','T','U','V','W','X',
            'Y','Z'
        ]
        let letras=bank.slice(0,2).toUpperCase()
        console.log(letras)
        let numeros=parseInt(bank.slice(2,4))
        console.log(numeros)
//Extraigo los dos indices de abecedario correspondientes a las letras. he consultado ChatGpt por errores de sintaxis, aunque no me ha sido de ayuda
        let index1=abecedario.includes(letras.charAt(0))?abecedario.indexOf(letras.charAt(0))+1:0
        let index2=abecedario.includes(letras.charAt(1))?parseInt(abecedario.indexOf(letras.charAt(1))+1):0
        let num=index1+index2
        if(num==numeros){
            return true;
        }
        return false;
    }

    let bank2part=(bank,cont)=>{
        /*El proceso es: separo 6 digitos, convierto a arraycon split,
        lo recorro reduciendo a la suma pero convirtiendo cada valor en int.
        */
        let slice1=bank.slice(0,6).split('')
        let part1=slice1.reduce((acc,i)=>acc+parseInt(i),0)
        console.log(part1)

        let slice2=bank.slice(6,13).split('')
        let part2=slice2.reduce((acc,i)=>acc+parseInt(i),0)
        console.log(part2)

        //Estraigo los numeros finales de control
        let control1=cont.charAt(0)
        let control2=cont.charAt(1)

        //hago la comprobación
        if((Math.trunc(part1/6))==control1&&
            (Math.trunc(part2/6))==control2){
                return true
            }

        return false

    }

    //Añado los eventos a los botones
    document.getElementById("b1").addEventListener("click", validarDatetime)
    document.getElementById("b2").addEventListener("click", validarcooker)
    document.getElementById("b3").addEventListener("click", validarAdress)
    document.getElementById("b4").addEventListener("click", validarGrs)
    document.getElementById("b5").addEventListener("click", validarComp)
    document.getElementById("b6").addEventListener("click", validarBank)

    //Este es el evento de comprobación total
    document.getElementById("checkall").addEventListener("click",()=>{
        let check=document.getElementById("check")
        check.innerHTML=''
        if(validarDatetime() &&
        validarcooker() &&
        validarAdress() &&
        validarGrs() &&
        validarComp() &&
        validarBank()){
            //añade un mensaje arriba de error o éxtito
            check.innerHTML='Todos los campos estan correctamente completados'
            check.style.background='lightgreen'
            return true
        }else{
            check.innerHTML='Algunos campos estan incorrectamente completados'
            check.style.background='lightcoral'
            return false

        }
    })
</script>
</html>